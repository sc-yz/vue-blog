# 哈哈

## 编译器和解释器

之所以存在编译器和解释器，是因为机器不能直接理解我们所写的代码，所以在执行程序之前，需要将我们所写的代码“翻译”成机器能读懂的机器语言。按语言的执行流程，可以把语言划分为编译型语言和解释型语言。

1. 编译型语言在程序执行之前，需要经过编译器的编译过程，并且编译之后会直接保留机器能读懂的二进制文件，这样每次运行程序时，都可以直接运行该二进制文件，而不需要再次重新编译了。比如 C/C++、GO 等都是编译型语言。

   在编译型语言的编译过程中，编译器首先会依次对源代码进行词法分析、语法分析，生成抽象语法树（AST），然后是优化代码，最后再生成处理器能够理解的机器码。如果编译成功，将会生成一个可执行的文件。但如果编译过程发生了语法或者其他的错误，那么编译器就会抛出异常，最后的二进制文件也不会生成成功。在解释型语言的解释过程中，同样解释器也会对源代码进行词法分析、语法分析，并生成抽象语法树（AST），不过它会再基于抽象语法树生成字节码，最后再根据字节码来执行程序、输出结果。

2. 解释型语言编写的程序，在每次运行时都需要通过解释器对程序进行动态解释和执行。 比如 Python、JavaScript 等都属于解释型语言。
   在解释型语言的解释过程中，同样解释器也会对源代码进行词法分析、语法分析，并生成抽象语法树（AST），不过它会再基于抽象语法树生成字节码，最后再根据字节码来执行程序、输出结果。

## V8 如何执行一段 Javascript 代码

    V8在执行过程中即有解释器Ignition，又有编译器TurboFan.

1. 生成抽象语法树（AST）和执行上下文（执行上下文+可执行的代码）

   生成 AST 过程:

   - 词法分析(分词)，其作用是将一行行的源码拆解成一个个 token,所谓的 token，指的是语法上不可能再分的，最小的单个字符和字符串
   - 语法分析(解析)，其作用是将上一步生成的 token 的数据，根据语法规则转为 AST,如果源码符合语法规则，这一步就会顺利完成，但是如果源码存在语法错误，这一步就会终止，并抛出一个语法错误。

2. 生成字节码

   有了 AST 和执行上下文后，解释器 Ignition 会根据 AST 生成字节码，并解释执行字节码。

   其实一开始 V8 没有字节码，而是直接将 AST 转换为机器码，由于执行机器码的效率是非常高校的,所以这种方式在发布后的一段时间内运行的效果非常好。但是 chorme 在手机上的普及，特别是运行在 512 内存手机上，内存占用问题暴露出来了，
   因为 V8 需要消耗大量的内存来存放转换后的机器码，为了解决内存占用问题，V8 重构了引擎架构

   什么是字节码？

   字节码就是介于 AST 和机器码之间的一种代码，但是与特定类型的机器码无关，字节码需要通过解释器将其转换为机器码后才能执行.

   机器码所占用的空间远远超过了字节码，所以使用字节码可以减少系统的内存使用。

3. 执行代码

   生成字节码之后
